import{i as U,u as V,r as a,H as Z,N as I,p as o,l as ee,j as e,D as n,P as C,B as p,E as se,Y as l,G as te,s as B,v as E,q as r}from"./vendor-B9IB914J.js";import{p as ae}from"./purple-mining-machine-qJc6x0wW.js";import{a as ie}from"./arrow-Dt4f_FJz.js";import{u as ne,w as re,t as k}from"./usePopup-KJQz5Xrc.js";import{n as ce}from"./no-open-CAtB8dC1.js";import{s as R}from"./started-CK8rpOhi.js";import{u as oe}from"./user-machine-DxW_ZeqC.js";import{f as le}from"./helper-Cniy7oTW.js";import{A as h,N as v}from"./index-YG593oy5.js";import{g as de}from"./CheckableItem-CjxYSjGN.js";import{c}from"../assets/index-D0p5yCsU.js";import{S as xe,L as g,I as me,C as fe}from"./index-Be7kqAQ1.js";import{M as ue}from"./MiningMachineSystemStorage-DvDQZY6X.js";import{M as N}from"./MiningMachineSystemLogic-BW-YOQBb.js";import"./selected-kuvggaMB.js";const Ee=()=>{const d=U(),{isConnected:j,address:x}=V(),[T,F]=a.useState(!1),s=Z().state||{id:0};console.log("machine detail",s);const X=()=>{d(-1,{state:{fromMachineDetail:!0}})},[m,H]=a.useState(0),[f,O]=a.useState(0),{data:y,isLoading:b,error:he}=I({address:g,abi:N,functionName:"getIDXAmount",args:[30]}),{data:w,isLoading:A,error:ve}=I({address:me,abi:se,functionName:"balanceOf",args:[x]});a.useEffect(()=>{A||O(Number(o(w)))},[A,w]),a.useEffect(()=>{b||H(Number(o(y)))},[b,y]);const _=()=>{te.confirm({content:"是否关停矿机",onConfirm:async()=>{try{const t=await B(c,{address:g,abi:N,functionName:"deactivateLP",args:[s.id]});if((await E(c,{hash:t,chainId:fe})).status==="success")r.show({content:"关停成功",position:"center"}),d("/user",{state:{needRefresh:!0},replace:!0});else throw new Error("交易未成功确认")}catch(t){r.show({content:"关停失败",position:"center"}),console.error(t)}}})},[z,u]=a.useState(!1),$=async()=>{if(u(!0),typeof s.id!="number"||s.id<=0){r.show({content:"矿机ID无效",position:"center",duration:2e3}),u(!1);return}try{const t=await B(c,{address:g,abi:N,functionName:"batchActivateMachinesWithLP",args:[[s.id]]});if((await E(c,{hash:t})).status==="success")r.show({content:"激活成功!",position:"center",duration:2e3}),D(!1),d("/user",{state:{needRefresh:!0},replace:!0});else throw new Error("交易未成功确认")}catch(t){r.show({content:`激活失败: ${t instanceof Error?t.message:"未知错误"}`,position:"center",duration:3e3}),console.error("激活失败详情:",t)}finally{u(!1)}},{setOpen:D,component:q}=ne({title:"",contentClassName:"",closeButtonClassName:"",content:e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"text-[#6433EC] font-bold text-[15px] pt-2 pb-4",children:"激活矿机需支付打底池费用!"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"font-bold text-[14px]",children:"待支付IDX"}),e.jsx("div",{className:"text-[#FF5050] font-bold text-[16px]",children:e.jsx(h,{type:v.BALANCE,value:+m,decimalSubLen:2,className:"ml-2 mr-1.5"})})]}),e.jsxs("div",{className:"flex justify-end text-[12px]",children:[e.jsx("div",{className:"text-[#686D6D]",children:"钱包余额："}),e.jsx("div",{className:"font-bold",children:e.jsx(h,{type:v.BALANCE,value:f,decimalSubLen:2,className:"ml-2 mr-1.5"})})]})]}),e.jsx(n,{}),e.jsx(p,{onClick:$,className:"!bg-black !rounded-3xl !text-white flex justify-center !py-10 w-full !text-[16px]",loading:z,disabled:f<m,children:f>m?"支付费用":"余额不足"})]})}),G=()=>{D(!0)},S=t=>t!==void 0&&t>0?+o(BigInt(t)):0,W=()=>{if(s.mtype===1){if(s.isActivatedStakedLP){const t=new Date().getTime()/1e3;return 90-l(t).diff(l(s.activatedAt),"day")}return 90}return Math.floor(360*(1440-S(s.producedMix))/1440)},Y=()=>{if(s.mtype===1){if(s.isActivatedStakedLP){const i=new Date().getTime()/1e3;return(90-l(i).diff(l(s.activatedAt),"day"))/90*100}return 0}return 360*(1440-S(s.producedMix))/1440/360*100},J=t=>{if(s.mtype===2){const P=t/1440;return parseFloat(P.toFixed(2))}return 0},K=t=>s.mtype===2?t/1440/360*100:0,M=()=>s.isActivatedStakedLP,L=a.useCallback(async()=>{if(j)try{const t=await ee(c,{address:xe,abi:ue,functionName:"isMotherMachineDistributor",args:[x]});F(t)}catch(t){console.log(t)}},[x,j]);a.useEffect(()=>{L()},[L]);const Q=()=>s.isActivatedStakedLP&&s.isProducing?R:s.destroyed?re:s.isActivatedStakedLP&&!s.isProducing&&s.mtype===1?R:s.isActivatedStakedLP&&!s.isProducing&&s.mtype===2?ce:s.isActivatedStakedLP?k:k;return e.jsxs("div",{className:"h-full overflow-scroll px-[21px]",children:[q,e.jsxs("div",{className:"flex pt-4",children:[e.jsx("img",{src:ie,alt:"返回",onClick:X}),e.jsx("span",{className:"m-auto text-[17px] font-bold",children:"矿机详情"})]}),e.jsxs("div",{className:"transfer-container mt-4 relative",children:[e.jsx("img",{src:Q(),alt:"矿机状态",width:50,className:"absolute right-[15px]"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("img",{src:s.mtype===1?ae:oe,alt:"矿机图标",width:50}),e.jsxs("div",{className:"flex flex-col gap-1 text-[.68rem]",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"text-[#666666]",children:"矿机编号："}),e.jsx("div",{className:"font-bold text-gray-800",children:typeof s.id=="number"&&s.id>0?`#${de(s.id)}`:"加载中..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"text-[#666666]",children:"矿机类型："}),e.jsx("div",{className:"font-bold text-[#BB7054]",children:s.mtype===1?"母矿机":"子矿机"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"text-[#666666]",children:"激活日期："}),e.jsx("div",{className:"font-bold",children:M()?le(s.activatedAt):"未激活"})]})]})]}),e.jsx(n,{}),e.jsxs("div",{className:"px-[20px] flex flex-col gap-2",children:[s.mtype===2&&e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"w-[100px] text-[#666666]",children:"燃料费剩余："}),e.jsx(C,{percent:K(s.fuelRemainingMinutes??0),className:"w-[45%]",style:{"--fill-color":"#615371"}}),e.jsxs("div",{className:"ml-2 font-bold",children:[J(s.fuelRemainingMinutes??0),"天"]})]}),e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"w-[100px] text-[#666666]",children:"生命剩余："}),e.jsx(C,{percent:Y(),className:"w-[45%]",style:{"--fill-color":"#615371"}}),e.jsxs("div",{className:"ml-2 font-bold",children:[W(),"天"]})]}),s.mtype===2&&e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"w-[100px] text-[#666666]",children:"累计产出积分："}),e.jsxs("div",{className:" font-bold text-[#4F4E4F]",children:[e.jsx(h,{type:v.BALANCE,value:+o(BigInt(s.producedMix??0)),decimalSubLen:2,className:"ml-2 mr-1.5"}),"MIX"]})]})]}),s.isActivatedStakedLP&&e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:'注：请谨慎执行本操作，矿机将立即停止运行，并将底池费用退还到你的钱包， 所有燃料费将清零，矿机状态回退到"未激活"状态；'}),M()?e.jsx(p,{className:"!mt-4 w-full !rounded-2xl !border-[#d6d6d6]",onClick:_,style:{fontSize:"14px"},children:"关停矿机"}):!T&&e.jsx(p,{className:"!mt-4 w-full !rounded-2xl !border-[#d6d6d6] !bg-black !text-white",onClick:G,style:{fontSize:"14px"},children:"激活矿机"})]}),e.jsxs("div",{className:"transfer-container mt-4 ",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"text-lg font-bold text-gray-800 text-[14px]",children:"矿机权益"}),e.jsx("div",{className:"text-[#666666] flex items-center text-[12px]",children:"注：激活后才能获得权益"})]}),e.jsx(n,{className:"!my-3"}),e.jsxs("div",{className:"flex text-[#666] text-[12px]",children:[e.jsx("div",{className:"w-[90px]",children:"矿机类型"}),e.jsx("div",{className:"flex-1",children:"权益"})]}),e.jsx(n,{className:"!my-3"}),e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"w-[90px] font-bold ",children:"母矿机"}),e.jsx("div",{className:"flex-1",children:"母矿机每10天产出1个矿机，母矿机不能产出MIX积分；"})]}),e.jsx(n,{className:"!my-3"}),e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"w-[90px] font-bold ",children:"矿机"}),e.jsx("div",{className:"flex-1",children:"每1台矿机每日产出4个MIX积分，每日00:00:00~01:00:00内到账"})]})]})]})};export{Ee as default};
