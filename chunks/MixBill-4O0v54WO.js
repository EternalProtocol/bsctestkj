import{u as L,i as A,r,l as x,o as S,p as c,q as E,j as e,F as T,S as F}from"./vendor-Cc6O52Rf.js";import{a as B}from"./arrow-Dt4f_FJz.js";import{f as u}from"./helper-glI5tH9e.js";import{c as d}from"../assets/index-oQAFiJ2g.js";import{H as X,P as h}from"./index-Bg3gkLV8.js";import{E as q}from"./EmptyComp-D1QD0REh.js";import{M as z}from"./MiningMachineHistory-BDg3MAA-.js";import{M as p}from"./MiningMachineProductionLogic-CseX3utK.js";const V=()=>{const{address:i}=L(),b=A(),[o,w]=r.useState([]),[I,g]=r.useState(!1),y=()=>{b("/user")},f=r.useCallback(async()=>{try{g(!0);const n=(await x(d,{address:X,abi:z,functionName:"getMixChildRecords",args:[i,0,100]})).map(s=>({type:0,mintOrderId:Number(s.mintOrderId),quantity:Number(s.quantity),timestamp:Number(s.timestamp),relatedBatchId:Number(s.relatedBatchId),mixConsumed:0})),t=(await x(d,{address:h,abi:p,functionName:"getUserReleaseIds",args:[i]})).map(s=>({address:h,abi:p,functionName:"getReleaseInfo",args:[i,s]})),l=(await S(d,{contracts:t})).map(s=>({totalAmount:+c(s.result[0]),startTime:Number(s.result[1]),releasedAmount:+c(s.result[2]),releasableAmount:+c(s.result[3]),remainingAmount:+c(s.result[4]),remainingLockTime:Number(s.result[5]),remainingReleaseTime:Number(s.result[6]),type:1})),M=(await x(d,{address:h,abi:p,functionName:"getClaimMixRecords",args:[i,0,100]})).map(s=>({amount:Number(c(s.amount)),machineId:Number(s.machineId),timestamp:Number(s.timestamp),type:2})),C=[...n,...l,...M].sort((s,H)=>H.timestamp-s.timestamp);w(C)}catch(a){console.error("查询记录失败:",a),E.show({content:"查询记录失败，请重试",duration:2e3})}finally{g(!1)}},[i]);r.useEffect(()=>{i&&f()},[f,i]);const[j,R]=r.useState(0),N=r.useRef(null);r.useEffect(()=>{if(!N.current)return;const a=()=>{const t=window.innerHeight-70;R(t)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const k=({index:a,style:n,data:m})=>{const t=m[a],v=l=>{switch(l){case 0:return"合成矿机";case 1:return"兑换IDX";case 2:return"提取MIX";default:return`未知状态(${l})`}};return e.jsx("div",{style:{...n,height:"136px"},children:e.jsxs("div",{className:"p-[20px] bg-white rounded-2xl text-[14px] flex flex-col gap-1 relative text-[#777777]",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"操作类型:"}),e.jsx("div",{className:"text-black ",children:v(t.type)})]}),t.type===0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"合成矿机数量:"}),e.jsx("div",{className:"text-black ",children:t.quantity})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"消耗MIX通证数:"}),e.jsx("div",{className:"text-black ",children:"80"})," ",e.jsx("div",{className:"text-black ",children:"MIX积分"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"矿机合成时间:"}),e.jsx("div",{className:"text-black ",children:t.timestamp?u(t.timestamp):"---"})]})]}),t.type===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"提取IDX数量:"}),e.jsx("div",{className:"text-black ",children:t.totalAmount.toFixed(4)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"提取时间:"}),e.jsx("div",{className:"text-black ",children:u(t.startTime)})]})]}),t.type===2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"提取积分:"}),e.jsx("div",{className:"text-black ",children:t.amount.toFixed(4)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"矿机编号:"}),e.jsx("div",{className:"text-black ",children:t.machineId})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"生成时间:"}),e.jsx("div",{className:"text-black ",children:u(t.timestamp)})]})]})]})})};return e.jsxs("div",{className:"h-full overflow-hidden px-[21px]",children:[e.jsxs("div",{className:"flex pt-4",children:[e.jsx("img",{src:B,alt:"返回",onClick:y,className:"cursor-pointer"}),e.jsx("span",{className:"m-auto text-[17px] ",children:"MIX账单"})]}),e.jsx("div",{ref:N,style:{height:`${j}px`,marginTop:"10px"},className:"no-scrollbar",children:I?e.jsx(F.Paragraph,{animated:!0,className:"customSkeleton"}):o.length>0?e.jsx(T,{height:j,width:"100%",itemCount:o.length,itemSize:145,itemData:o,children:k}):e.jsx(q,{})})]})};export{V as default};
