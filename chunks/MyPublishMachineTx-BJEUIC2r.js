import{H as I,Y as c,u as L,i as k,r as l,j as e,B as o,F as M,s as T,v as B,q as v}from"./vendor-B9IB914J.js";import{a as E}from"./arrow-Dt4f_FJz.js";import{u as F}from"./user-machine-DxW_ZeqC.js";import{L as z,C as R}from"./index-DPA4qk5L.js";import{s as N,f as b}from"./helper-Cniy7oTW.js";import{c as u}from"../assets/index-Crcy1d53.js";import{o as O}from"./orderStore-pIUwuKFS.js";import{M as P}from"./MiningMachineSystemLogic-BW-YOQBb.js";const V=()=>{const t=I().state,n=15-c(new Date().getTime()/1e3).diff(t.listedAt,"day"),i=t.listedAt*1e3,w=c(i).add(15,"day"),h=c().isAfter(w),{address:y}=L(),d=O.getOrders().filter(s=>s.seller===y&&s.status===1&&s.orderType===3),r=k(),[m,D]=l.useState(0),f=l.useRef(null),[p,g]=l.useState(!1),S=()=>{r("/user")};l.useEffect(()=>{if(!f.current)return;const s=()=>{const H=window.innerHeight-354;D(H)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const A=async()=>{var s;try{g(!0);const a=await T(u,{address:z,abi:P,functionName:"cancelListedChildMachine",args:[t.orderId]});await B(u,{hash:a,chainId:R}),v.show({content:"下架成功",position:"center"}),r("/user")}catch(a){console.error("取消订单失败:",a);const j=((s=a.data)==null?void 0:s.message)||"取消失败，请稍后重试";v.show({content:j,position:"center"})}finally{g(!1)}},C=()=>{r("/user/sellToPlatform",{state:t})};return e.jsxs("div",{className:"px-[21px]",children:[e.jsxs("div",{className:"flex pt-4 mb-4",children:[e.jsx(o,{onClick:S,className:"!p-[0] !rounded-2xl",loading:p,children:e.jsx("img",{src:E,alt:""})}),e.jsx("span",{className:"m-auto text-[19px] font-bold",children:"我的挂售"})]}),e.jsxs("div",{className:"p-[15px] bg-white rounded-3xl",children:[e.jsxs("div",{className:" flex gap-2",children:[e.jsx("img",{src:F,alt:"",width:50}),e.jsxs("div",{className:"flex text-[11px] flex-1",children:[e.jsxs("div",{className:"w-[60px] flex flex-col gap-1 text-[#5B5B5B]",children:[e.jsx("div",{children:"出售中"}),e.jsx("div",{children:"矿机卖家:"}),e.jsx("div",{children:"上架时间:"})]}),e.jsxs("div",{className:"ml-auto w-[73%] font-bold flex flex-col gap-1",children:[e.jsx("div",{children:"..."}),e.jsx("div",{children:N(t.seller,4)}),e.jsx("div",{className:"text-[11px]",children:b(t.listedAt)})]})]}),e.jsx("div",{className:"flex text-[12px]",children:e.jsxs("div",{className:"flex flex-col justify-between items-center",children:[e.jsx("div",{className:"bg-[#895EFF] rounded-2xl px-2 text-white ",children:"我发布的"}),e.jsxs("div",{className:"text-[#895EFF]",children:["NO.",t.NO]})]})})]}),e.jsxs("div",{className:"mt-6 relative",children:[e.jsxs("div",{className:"flex gap-2 mb-2 ",children:[e.jsx(o,{loading:p,onClick:A,className:"flex-1 !rounded-3xl !border-2 !border-dashed !border-[#e1e1e1]",style:{fontSize:"14px",padding:"5px"},children:"下架"}),e.jsxs(o,{disabled:!h,onClick:C,className:"flex-1 !rounded-3xl !border-2 !border-dashed !border-[#e1e1e1] ",children:["卖给平台",!h&&e.jsxs("div",{className:"absolute top-[-20px] right-0 bg-[#3D3B42] rounded-[5px] text-white text-[12px] px-2 py-0.5",children:[n,"日后可售卖"]})]})]}),e.jsx("div",{className:"text-[#6D6D6D] text-[12px] text-center ",children:"15天未售出，平台支持16U/台等值IDX进行回收"})]})]}),d.length>0&&e.jsx("div",{className:"py-2 pl-4 text-[15px] text-[#595C5C]",children:"交易历史"}),e.jsx("div",{ref:f,style:{height:`${m}px`},className:"no-scrollbar rounded-2xl ",children:e.jsx(M,{height:m,width:"100%",itemCount:d.length,itemSize:152,itemData:d,children:X})})]})},X=({index:x,style:t,data:n})=>{const i=n[x];return e.jsx("div",{style:{...t,height:"110px"},children:e.jsxs("div",{className:"p-[15px] bg-white rounded-3xl flex flex-col gap-1 text-[#777777] relative",children:[e.jsx("div",{className:"bg-[#9b93af] rounded-3xl text-white px-4 py-0.5 absolute right-[20px] top-[15px] text-[12px]",children:"已完成"}),e.jsxs("div",{className:"flex",children:["交易类型：",e.jsx("div",{className:"text-black font-bold",children:"矿机挂售"})]}),e.jsxs("div",{className:"flex",children:["收益单价：",e.jsxs("div",{className:"text-black font-bold",children:[i.priceInIdx," IDX/台"]})]}),e.jsxs("div",{className:"flex",children:["订单数量：",e.jsx("div",{className:"text-black font-bold",children:"1台"})]}),e.jsxs("div",{className:"flex",children:["交易时间：",e.jsx("div",{className:"text-black font-bold",children:b(i.listedAt)})]}),e.jsxs("div",{className:"flex",children:["购买方钱包地址：",e.jsx("div",{className:"font-bold text-black",children:N(i.buyer,4)})]})]})})};export{V as default};
