import{u as ie,r as a,i as ce,l as H,o as p,j as e,x as le,y as oe,F as de,S as me,z as ue,A as he,E as D,p as F,q as xe}from"./vendor-B9IB914J.js";import{u as fe,c as ge,i as pe}from"./index-B_atygiO.js";import{c as h}from"../assets/index-D0p5yCsU.js";import{C as be}from"./CheckableItem-CjxYSjGN.js";import{A as S,N as j}from"./index-YG593oy5.js";import{H as y,S as L,P as Ne,C as Ce,I as we,U as ve}from"./index-Be7kqAQ1.js";import{M as k}from"./MiningMachineHistory-BDg3MAA-.js";import{M as A}from"./MiningMachineSystemStorage-DvDQZY6X.js";import{M as Se}from"./MiningMachineProductionLogic-CseX3utK.js";import{t as je}from"./transfer-CmFgXUEi.js";import{s as ye}from"./selected-kuvggaMB.js";import"./purple-mining-machine-qJc6x0wW.js";import"./helper-Cniy7oTW.js";const Le="data:image/svg+xml,%3csvg%20viewBox='0%200%2026.0188%2026.0186'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='26.0187988'%20height='26.0185547'%20fill='none'%20customFrame='%23000000'%3e%3cg%20id='组合%20240'%3e%3ccircle%20id='椭圆形'%20cx='13'%20cy='13'%20r='13'%20fill='rgb(255,255,255)'%20transform='matrix(1,0.000727309,-0.000727309,1,0.0187988,0)'%20/%3e%3ccircle%20id='椭圆形'%20cx='13'%20cy='13'%20r='12.1999998'%20stroke='rgb(151,151,151)'%20stroke-opacity='0'%20stroke-width='1.60000002'%20transform='matrix(1,0.000727309,-0.000727309,1,0.0187988,0)'%20/%3e%3cpath%20id='path'%20d='M6.26965%200.893975C6.41647%200.346702%206.95577%200%207.49365%200C8.08094%200%208.57082%200.398278%208.71765%200.944118C8.86447%201.5401%208.62024%202.03723%207.98353%202.33522C7.83671%202.38537%207.68988%202.53436%207.68988%202.68336L7.68988%203.72776L7.29741%203.72776L7.29741%202.58451C7.29741%202.48565%207.10118%202.38537%207.00377%202.33666C6.36706%201.98709%206.12282%201.48996%206.26965%200.893975ZM1.66588%208.59735C0.784941%208.59735%200.0494118%207.90108%200%207.05582C0%206.16184%200.686118%205.46557%201.66588%205.41543L1.66588%208.59735ZM12.7341%208.59735L12.7341%205.41686C13.6151%205.36672%2014.4%206.11313%2014.4%206.9584C14.4%207.85237%2013.6165%208.64749%2012.7341%208.59735ZM11.9026%204.2736L11.9026%209.6919C11.9026%2010.189%2011.8052%2010.2879%2011.2165%2010.338C11.2165%2010.338%209.03529%2010.3379%209.06071%2010.338C9.03529%2011.4612%205.38878%2011.5301%205.38871%2010.2879L2.98871%2010.2879C2.59624%2010.2879%202.44941%2010.1389%202.44941%209.79075L2.44941%204.22346C2.44941%203.82518%202.59624%203.72633%203.03671%203.72633L11.2659%203.72633C11.8038%203.67762%2011.9026%203.77647%2011.9026%204.2736ZM5.92659%206.95696C5.92659%206.50998%205.53412%206.16184%205.04565%206.16184C4.60518%206.16184%204.21271%206.50998%204.21271%206.95696L4.21271%207.00711C4.21271%207.45409%204.60518%207.85237%205.09365%207.85237C5.58353%207.80223%205.92659%207.45409%205.92659%206.95696ZM10.2367%207.00711C10.2367%206.56012%209.89365%206.16184%209.40376%206.16184L9.35435%206.16184C8.86447%206.16184%208.47341%206.50998%208.47341%206.95696C8.47341%207.40395%208.86588%207.80223%209.35435%207.80223C9.84424%207.85237%2010.2367%207.45409%2010.2367%207.00711Z'%20fill='rgb(44.4392,42.3482,50.0893)'%20fill-rule='nonzero'%20transform='matrix(1,0.000727309,-0.000727309,1,6.01367,7.00391)'%20/%3e%3c/g%3e%3c/svg%3e",Ue=()=>{const{address:o}=ie(),[m,C]=a.useState([]),[u,w]=a.useState(!1),[M,O]=a.useState(0),T=a.useRef(null),[l,x]=a.useState([]),v=ce(),[R,U]=a.useState(""),[z,Z]=a.useState(""),[_,Q]=a.useState(""),[X,I]=a.useState(!1),[q,$]=a.useState("0"),[G,J]=a.useState("0"),[b,K]=a.useState(0),B=a.useCallback(async()=>{try{const t=await H(h,{address:y,abi:k,functionName:"getSellerOrderIds",args:[o,0,100]});console.log("orderIds",t);const c=t.map(i=>Number(i)).map(i=>({address:y,abi:k,functionName:"allOrders",args:[i]})),n=(await p(h,{contracts:c})).map(i=>({orderId:Number(i.result[0]),seller:i.result[1],buyer:i.result[2],createTime:String(i.result[3]),status:i.result[4],orderType:i.result[5]})),d=n.filter(i=>i.status===0);K(d.length),console.log("sale person transfer history detail",n)}catch(t){console.error(t)}},[o]);a.useEffect(()=>{B()},[B]),a.useEffect(()=>{u&&x(m)},[u,m]),a.useEffect(()=>{l.length===m.length&&l.length>0&&w(!0)},[l.length,m.length]);const V=()=>{C(t=>{const r=t.map(c=>({...c,checked:!u}));return x(u?[]:r),r}),w(!u)},E=a.useCallback(async()=>{I(!0);try{const r=(await H(h,{address:L,abi:A,functionName:"getOwnerToMachineIds",args:[o]})).map(s=>Number(s)),c=r.map(s=>({address:L,abi:A,functionName:"getMachineLifecycle",args:[s]})),n=(await p(h,{contracts:c})).map((s,g)=>({activatedAt:Number(s.result.activatedAt),createTime:Number(s.result.createTime),expiredAt:Number(s.result.expiredAt),destroyed:s.result.destroyed,isActivatedStakedLP:s.result.isActivatedStakedLP,isFuelPaid:s.result.isFuelPaid,isProducing:s.result.isProducing,lastProduceTime:Number(s.result.lastProduceTime),mtype:s.result.mtype,producedChildCount:Number(s.result.producedChildCount),producedHours:Number(s.result.producedHours),id:r[g],checked:!1,status:s.status})),d=n.map(s=>({address:Ne,abi:Se,functionName:"viewMachineProduction",args:[s.id]})),i=await p(h,{contracts:d}),P=n.map((s,g)=>({...s,unclaimedChildCount:Number(i[g].result[2])})),re=P.map(s=>({address:L,abi:A,functionName:"_isOnSale",args:[s.id]})),ne=await p(h,{contracts:re});let N=P.map((s,g)=>({...s,isOnSale:ne[g].result}));N=N.filter(s=>!s.isOnSale),C(N),console.log("sale person machine list",N)}catch(t){console.error(t)}finally{I(!1)}},[o]);a.useEffect(()=>{E()},[E]),a.useEffect(()=>{(async()=>{try{const r=await ue(h,{address:o,chainId:Ce}),c=he(r.value,r.decimals);U(c);const n=await p(h,{contracts:[{address:we,abi:D,functionName:"balanceOf",args:[o]},{address:ve,abi:D,functionName:"balanceOf",args:[o]},{address:y,abi:k,functionName:"getAddressStats",args:[o]}]});Z(F(n[0].result)),Q(F(n[1].result));const d=n[2].result;console.log("motherMachineStatus",d),$(String(d[0])),J(String(d[2]))}catch(r){console.error(r)}})()},[o]);const W=a.useCallback(t=>{C(r=>{const c=r.map(n=>n.id===t.id?{...n,checked:!n.checked}:n);if(!t.checked)x(u?m:[...l,t]);else{const n=l.filter(d=>d.id!==t.id);x(n),w(!1)}return c})},[u,m,l]),Y=t=>{v("/user/machineDetail",{state:t})},ee=a.memo(({index:t,style:r,data:c})=>{const f=c[t];return e.jsx("div",{style:{...r,height:"70px"},children:e.jsx(be,{item:f,onLeftClick:W,onRightClick:Y})})});a.useEffect(()=>{if(!T.current)return;const t=()=>{const c=window.innerHeight;O(c)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const te=()=>{if(l.length===0){xe.show({content:"请选择要转让的矿机",position:"center",duration:2e3});return}v("/transfer-machine",{state:l})},se=t=>t?e.jsx("img",{src:ye,alt:"",width:16,height:16}):e.jsx("div",{className:"border border-[#a5a4a4] w-[1rem] h-[1rem] rounded-[50%]"}),ae=()=>{v("/sale-person/history")};return e.jsxs("div",{className:"pt-4 flex flex-col justify-between h-full overflow-scroll",children:[e.jsxs("div",{className:"px-[21px]",children:[e.jsxs("div",{className:"bg-[#09090a] rounded-2xl text-white p-5 text-[1rem] relative",children:[e.jsx("div",{className:"text-[#c6c6c6] text-[11px] font-[400]",children:"我的钱包余额"}),e.jsxs("div",{className:"flex items-center mt-5 mb-2",children:[e.jsx("div",{className:"bg-[#895eff] rounded-[50%] w-[19px] h-[19px]  "}),e.jsxs("div",{children:[e.jsx(S,{type:j.BALANCE,value:z,decimalSubLen:2,className:"ml-2 mr-1.5"}),e.jsx("span",{className:"text-[#c6c6c6] text-[12px] font-[400]",children:"IDX"})]})]}),e.jsxs("div",{className:"flex mb-2",children:[e.jsx("img",{src:fe,alt:"",width:19,height:19}),e.jsxs("div",{children:[e.jsx(S,{type:j.BALANCE,value:_,decimalSubLen:2,className:"ml-2 mr-1.5"}),e.jsx("span",{className:"text-[#c6c6c6] text-[12px] font-[400]",children:"USDT"})]})]}),e.jsxs("div",{className:" flex",children:[e.jsx("img",{src:ge.bscSvg,alt:"",width:19,height:19}),e.jsxs("div",{children:[e.jsx(S,{type:j.BALANCE,value:R,decimalSubLen:2,className:"ml-2 mr-1.5"}),e.jsx("span",{className:"text-[#c6c6c6] text-[12px] font-[400]",children:"BNB"})]})]}),e.jsx("img",{src:pe,alt:"",width:180,height:87,className:"absolute bottom-[20px] right-[20px]"})]}),e.jsxs("div",{className:"bg-[#09090a] rounded-t-2xl text-white  p-5 text-[1.125rem] mt-4",children:[e.jsx("div",{className:"text-white text-[.75rem] ",children:"我的母矿机总数"}),e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx("img",{src:Le,alt:"",width:26,height:26}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[1.5rem] font-[400] mx-2",children:q}),e.jsx("span",{className:"text-[.875rem] font-[400]",children:"台"})]})]})]}),e.jsxs("div",{className:"bg-white text-[#636262] rounded-b-2xl p-3 text-[.875rem] flex justify-between",children:[e.jsxs("div",{children:["累计转出:",e.jsx("span",{className:"font-bold text-[1rem] mx-2",children:G}),"台"]}),e.jsxs("div",{className:"flex gap-2 items-center",onClick:ae,children:["矿机转让记录",e.jsx("div",{className:le([b===0?"bg-[#E3E3E3]":"bg-[#ff5353]"],[b===0?"text-black":"text-white"],"rounded-[50%]  w-[20px] h-[20[px]  flex justify-center items-center"),children:b===0?e.jsx(e.Fragment,{children:"i"}):b})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(oe,{className:"mr-6",checked:u,icon:t=>se(t),onClick:V,style:{"--font-size":"13px","--gap":"6px"},children:"全选"})}),e.jsx("div",{ref:T,style:{height:`${M}px`},className:"no-scrollbar mb-[4rem]",children:X?e.jsx(me.Paragraph,{animated:!0,className:"customSkeleton"}):e.jsx(de,{height:M,width:"100%",itemCount:m.length,itemSize:105,itemData:m,children:ee})})]}),e.jsxs("div",{className:"fixed bottom-0  w-full bg-white h-[4rem] flex items-center mt-auto px-[21px]",onClick:te,children:[l.length>0&&e.jsx("div",{className:"bg-[#F1F1F3] rounded-[50%] w-[32px] h-[32px] flex justify-center items-center text-[#895FFE] font-bold",children:l.length}),e.jsxs("div",{className:"flex flex-col items-center justify-center mx-auto",children:[e.jsx("img",{src:je,alt:"",width:18}),e.jsx("span",{className:"text-[14px] mt-1",children:"转让矿机"})]})]})]})};export{Ue as default};
