import{i as E,H as U,r,j as e,B as D,T as k,D as f,F as z,l as F,p as X,q as d,s as $,v as P,J as V}from"./vendor-B9IB914J.js";import{a as J}from"./arrow-Dt4f_FJz.js";import{v as O}from"./validateAddress-BE2p6uyu.js";import{c as g}from"../assets/index-CUaiFQEv.js";import{L as H,C as q}from"./index-BrAFJQrS.js";import{M as S}from"./MiningMachineSystemLogic-BW-YOQBb.js";const Z=x=>{var o;const j=x+"",s=V.SHA256(j).toString(),c=((o=s.match(/[a-zA-Z]/g))==null?void 0:o.slice(0,4).join(""))||"ABCD",h=s.slice(10,14);return(c+h).toUpperCase()},ee=()=>{const x=E(),s=U().state,[c,h]=r.useState(""),[o,v]=r.useState(!1),w=()=>{x("/user/toBeActivatedMachine")},[N,I]=r.useState(0),b=r.useRef(null),[y,A]=r.useState(0);r.useEffect(()=>{if(!b.current)return;const t=()=>{const a=window.innerHeight-540;I(a)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const C=async()=>{var n,i;if(s&&s.length>30){d.show({content:"最多只能转让30台矿机",position:"center",duration:2e3});return}if(!((i=(n=O)==null?void 0:n.EVM)==null?void 0:i.call(n,c))){d.show({content:"请输入合法的BNB地址",position:"center",duration:2e3});return}try{const a=s.map(l=>l.id);d.show({content:"转让中...",position:"center",duration:0}),v(!0);const m=await $(g,{address:H,abi:S,functionName:"createInternalMachineOrder",args:[c,a]});await P(g,{hash:m,chainId:q}),d.clear(),w()}catch(a){console.error(a)}finally{v(!1)}},T=t=>{h(t)},L=async()=>{try{const t=await F(g,{address:H,abi:S,functionName:"getIDXAmount",args:[1]}),n=X(t);A(+n)}catch(t){console.error(t)}};r.useEffect(()=>{L()},[]);const M=s.reduce((t,n)=>{let a=(150*(1-n.producedHours/360)-30)*y;return a<0&&(a=0),t+a},0),R=({index:t,style:n,data:i})=>{const a=i[t],m=p=>150*(1-p/360)-30===120?"新矿机":"二手矿机",l=p=>{let u=(150*(1-p/360)-30)*y;return u<0&&(u=0),u};return e.jsxs("div",{style:{...n,height:"50px"},children:[e.jsxs("div",{className:"flex py-2 text-[12px]",children:[e.jsx("div",{className:"w-[55px] ",children:t+1}),e.jsxs("div",{className:"w-[100px] mr-[10px]",children:["#",Z(a.id)]}),e.jsx("div",{className:"w-[80px] mr-auto",children:m(a.producedHours)}),e.jsxs("div",{className:`${l(a.producedHours)===0&&"text-[red]"}`,children:[l(a.producedHours)," IDX"]})]}),e.jsx(f,{className:"!my-[0]"})]})};return e.jsxs("div",{children:[e.jsxs("div",{className:"h-full overflow-hidden px-[21px] text-[14px] relative",children:[e.jsxs("div",{className:"flex pt-4",children:[e.jsx(D,{onClick:w,className:"!p-[0] !rounded-2xl",loading:o,children:e.jsx("img",{src:J,alt:""})}),e.jsx("span",{className:"m-auto text-[17px] font-bold text-black",children:"转让矿机"})]}),e.jsxs("div",{className:"transfer-container mt-4",children:[e.jsx("div",{className:"text-[14px] font-bold mb-4 text-black",children:"接收方钱包地址"}),e.jsx(k,{value:c,rows:2,className:"bg-[#ececee] rounded-3xl p-3",placeholder:"输入对方的钱包地址",onChange:T,style:{"--font-size":"14px"}})]}),e.jsxs("div",{className:"transfer-container mt-4 text-[14px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:" font-bold  text-black",children:"待转让详情"}),e.jsxs("div",{className:"text-[12px]",children:["共计：",e.jsx("span",{className:`mr-2 text-[18px] font-bold ${s.length>30?"text-red-500":"text-black"}`,children:s.length}),"台",s.length>30&&e.jsxs("span",{className:"text-red-500 text-xs ml-1",children:["（超过最大限制",e.jsx("strong",{children:"30"}),"台）"]})]})]}),e.jsx("div",{className:"flex justify-between text-[11px] mb-4",children:"(每台手续费30U等值IDX)"}),e.jsx(f,{className:"!mt-[10px] !mb-[0]"}),e.jsxs("div",{className:"flex justify-between py-2 text-[#777777] text-[12px]",children:[e.jsx("div",{children:"#"}),e.jsx("div",{children:"矿机编号"}),e.jsx("div",{children:"矿机类型"}),e.jsx("div",{children:"每台收益"})]}),e.jsx(f,{className:"!mt-[10px] !mb-[0]"}),e.jsx("div",{ref:b,style:{height:`${N}px`},className:"no-scrollbar",children:e.jsx(z,{height:N,width:"100%",itemCount:s.length,itemSize:50,itemData:s,children:R})})]})]}),e.jsxs("div",{className:"w-full bg-white h-[4rem] flex items-center absolute bottom-0 px-[30px]",children:[e.jsxs("div",{children:[e.jsx("div",{children:"待收款 IDX"}),e.jsx("div",{className:"text-[#FF6D6D] text-[22px]",children:M})]}),e.jsx(D,{className:`!rounded-3xl !ml-auto !h-[40px] !w-[100px] ${s.length>30?"!bg-gray-300 !text-gray-500 cursor-not-allowed":"!bg-black !text-white"}`,style:{fontSize:"15px"},onClick:C,loading:o,disabled:s.length>30,children:"转出矿机"})]})]})};export{ee as default};
