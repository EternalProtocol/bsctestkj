import{n as b,u as $,r as d,v as h}from"./vendor-B9IB914J.js";import{c as m}from"../assets/index-D0p5yCsU.js";import{M as C}from"./MiningMachineSystemLogic-BW-YOQBb.js";function v(){const{writeContractAsync:r}=b(),{chain:s}=$(),g=d.useCallback(async n=>{var o,i;if(!(s!=null&&s.id))throw new Error("No connected chain");const a=[];for(let e=0;e<n.length;e++){const t=n[e],f={functionName:t.functionName,callIndex:e};try{console.log(`Executing call ${e+1}/${n.length} to ${t.functionName}...`);const c=await r({address:t.address,abi:t.abi,functionName:t.functionName,args:t.args||[],value:t.value||BigInt(0),chainId:s.id});console.log(`Waiting for confirmation of call ${e+1} (${t.functionName})...`);const l=await h(m,{hash:c});if(t.onConfirmed)try{await t.onConfirmed(l,e)}catch(u){console.error(`onConfirmed callback failed for call ${e+1}:`,u)}a.push({...f,success:!0,txHash:c,receipt:l}),console.log(`Call ${e+1} (${t.functionName}) confirmed with txHash: ${c}`)}catch(c){if(((c==null?void 0:c.name)==="UserRejectedRequestError"||(c==null?void 0:c.code)===4001||((o=c==null?void 0:c.message)==null?void 0:o.includes("User rejected"))||((i=c==null?void 0:c.message)==null?void 0:i.includes("用户拒绝")))&&t.onCancel)try{await t.onCancel(e,c)}catch(u){console.error(`第 ${e+1} 个调用的 onCancel 回调失败:`,u)}a.push({...f,success:!1,error:c})}}return a},[r,s==null?void 0:s.id]),w=d.useCallback(async(n,a)=>{var o,i;if(!(s!=null&&s.id))throw new Error("未连接区块链网络");if(!a.length)throw new Error("请传入至少一个矿机ID");if(a.some(e=>e<0n))throw new Error("矿机ID不能为负数");try{console.log(`开始批量激活矿机，共 ${a.length} 台，函数: batchActivateMachinesWithLP`);const e=await r({address:n,abi:C,functionName:"batchActivateMachinesWithLP",args:[a],chainId:s.id});console.log(`等待批量激活交易确认，哈希: ${e}`);const t=await h(m,{hash:e});return console.log(`批量激活成功，区块号: ${t.blockNumber}`),{success:!0,txHash:e,receipt:t,functionName:"batchActivateMachinesWithLP"}}catch(e){const t=(e==null?void 0:e.name)==="UserRejectedRequestError"||(e==null?void 0:e.code)===4001||((o=e==null?void 0:e.message)==null?void 0:o.includes("User rejected"))||((i=e==null?void 0:e.message)==null?void 0:i.includes("用户拒绝"));return console.error(`批量激活失败: ${t?"用户已取消":e}`),{success:!1,error:t?"用户取消操作":e,functionName:"batchActivateMachinesWithLP"}}},[r,s==null?void 0:s.id]);return{executeSequentialCalls:g,batchActivateMachinesWithLP:w}}export{v as u};
