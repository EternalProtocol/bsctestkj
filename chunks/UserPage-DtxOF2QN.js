import{r as s,u as fe,l as z,o as y,j as e,K as he,x as we,L as Se,y as Ie,P as ze,J as We,p as F,i as Ce,H as $e,B as Ne,D as ve,F as Le,S as Qe,z as Ke,A as Je,E as je,q as Ae,I as qe}from"./vendor-B9IB914J.js";import{o as ne}from"./orderStore-pIUwuKFS.js";import{c as m}from"../assets/index-CUaiFQEv.js";import{H as oe,L as O,S as me,P as Ze,C as Ge,I as Be,U as Ve}from"./index-BrAFJQrS.js";import{M as ue}from"./MiningMachineHistory-BDg3MAA-.js";import{M as P}from"./MiningMachineSystemLogic-BW-YOQBb.js";import{u as Ye,c as et,i as tt}from"./index-B_atygiO.js";import{s as Me}from"./selected-kuvggaMB.js";import{n as st}from"./no-open-CAtB8dC1.js";import{s as at}from"./started-CK8rpOhi.js";import{u as ye}from"./user-machine-DxW_ZeqC.js";import{A as _,N as D}from"./index-YG593oy5.js";import{E as ke}from"./EmptyComp-DbFDXUVs.js";import{M as xe}from"./MiningMachineSystemStorage-DvDQZY6X.js";import{M as rt}from"./MiningMachineProductionLogic-CseX3utK.js";import{n as nt}from"./next-arrow-_-KGsGbq.js";import{s as it,f as ct}from"./helper-Cniy7oTW.js";import{T as lt}from"./TopBarConnectButton-q8XxVLUu.js";const dt="/assets/gas-BcQTQbwx.svg",ot={"adm-tabs":"_adm-tabs_100c5_1","adm-tabs-tab-active":"_adm-tabs-tab-active_100c5_11"},mt=({tabs:a,customClassName:c,getTabKey:b,defaultKey:x,titleFontSize:u})=>{const N=s.useRef(null),[w,U]=s.useState("1"),[C,A]=s.useState(1),{address:S}=fe(),W=ne.getUnPaidLength();s.useEffect(()=>{b&&b(+w)},[w,b]),s.useEffect(()=>{x!==void 0&&(A(x),H(`${x}`))},[x]);const H=d=>{var o;U(d),(o=N==null?void 0:N.current)==null||o.swipeTo(Number(d))},h=s.useCallback(async()=>{try{const o=(await z(m,{address:oe,abi:ue,functionName:"getBuyerOrderIds",args:[S,0,100]})).map(t=>Number(t)),B=o.map(t=>({address:oe,abi:ue,functionName:"allOrders",args:[t]})),$=(await y(m,{contracts:B})).map(t=>({orderId:Number(t.result[0]),seller:t.result[1],buyer:t.result[2],createTime:String(t.result[3]),status:t.result[4],orderType:t.result[5]})),M=o.map(t=>({address:O,abi:P,functionName:"internalOrders",args:[t]})),G=await y(m,{contracts:M}),I=$.map((t,L)=>({...t,price:Number(G[L].result[2])})),Q=o.map(t=>({address:O,abi:P,functionName:"getInternalOrderMachineIds",args:[t]})),V=await y(m,{contracts:Q}),K=I.map((t,L)=>{const ae=V[L].result.map(re=>Number(re));return{...t,machineIds:ae}});console.log("buyer list",K);const i=(await z(m,{address:oe,abi:ue,functionName:"getSellerOrderIds",args:[S,0,100]})).map(t=>Number(t)),k=i.map(t=>({address:oe,abi:ue,functionName:"allOrders",args:[t]})),p=(await y(m,{contracts:k})).map(t=>({orderId:Number(t.result[0]),seller:t.result[1],buyer:t.result[2],createTime:String(t.result[3]),status:t.result[4],orderType:2})),X=i.map(t=>({address:O,abi:P,functionName:"internalOrders",args:[t]})),Y=await y(m,{contracts:X}),R=p.map((t,L)=>({...t,price:Number(Y[L].result[2])})),ee=i.map(t=>({address:O,abi:P,functionName:"getInternalOrderMachineIds",args:[t]})),te=await y(m,{contracts:ee}),se=R.map((t,L)=>{const ae=te[L].result.map(re=>Number(re));return{...t,machineIds:ae}});console.log("seller list",se);let j=[...K,...se];const l=ne.getallListedOrders().map(t=>({...t,orderType:3}));j=j.filter(t=>t.machineIds.length!==0&&(t.seller===S||t.buyer===S)).concat(l).sort((t,L)=>t.status-L.status);const g=j.filter(t=>t.status===0&&(t.seller===S||t.buyer===S)&&!t.listedAt).length;ne.updateData(j,g)}catch(d){console.error(d)}},[S]);return s.useEffect(()=>{h()},[h]),e.jsxs("div",{className:"h-full relative",children:[e.jsx(he,{activeKey:w,onChange:H,stretch:!1,className:we(c,[ot["adm-tabs"]],` ml-[15px]
            h-[48px] !shrink-0  [&_.adm-tabs-tab-wrapper]:flex-none [&_.adm-tabs-tab-wrapper]:px-0  
            [&_.adm-tabs-tab.adm-tabs-tab-active]:font-medium [&_.adm-tabs-tab.adm-tabs-tab-active]:opacity-100 
            [&_.adm-tabs-tab]:pb-[11px] [&_.adm-tabs-tab]:pt-[14px] [&_.adm-tabs-tab]:text-[15px] 
            [&_.adm-tabs-tab]:opacity-40 [&_.adm-tabs-tab]:transition-transform
          `),style:{"--title-font-size":`${u||"1.06rem"}`},children:a.map((d,o)=>e.jsx(he.Tab,{title:d.title,className:""},o))}),W>0&&e.jsx("div",{className:"absolute top-[.1875rem] left-[8.9rem]  bg-[red] h-[.6875rem] w-[.6875rem] p-1 rounded-3xl flex items-center justify-center text-white text-[.6rem] leading-[.6rem]"}),e.jsx(Se,{className:"!h-[calc(100%-48px)] outline-0",ref:N,indicator:()=>null,tabIndex:Number(w),defaultIndex:C,onIndexChange:d=>U(`${d}`),children:a.map((d,o)=>e.jsx(Se.Item,{className:"no-scrollbar max-w-full overflow-y-auto overflow-x-hidden ",children:d.children},o))})]})},Te={"adm-tabs":"_adm-tabs_14udc_1","adm-tabs-tab-active":"_adm-tabs-tab-active_14udc_13","machine-name":"_machine-name_14udc_21"},ut=a=>a/1440/360*100,xt=a=>360*(1440-bt(a))/1440,ht=a=>{const b=a/1440;return parseFloat(b.toFixed(2))},ft=a=>{var N;const c=a+"",b=We.SHA256(c).toString(),x=((N=b.match(/[a-zA-Z]/g))==null?void 0:N.slice(0,4).join(""))||"ABCD",u=b.slice(10,14);return(x+u).toUpperCase()},bt=a=>a!==void 0&&a>0?+F(BigInt(a)):0,pt=({item:a,onLeftClick:c,onRightClick:b})=>{const x=()=>a.producedMix!==void 0&&a.producedMix>0?+F(BigInt(a.producedMix)):0;return e.jsxs("div",{className:"bg-white rounded-2xl p-2 flex justify-between  text-[.68rem]",children:[e.jsxs("div",{className:"flex relative",onClick:()=>c(a),children:[e.jsx(Ie,{checked:a.checked,icon:u=>u?e.jsx("img",{src:Me,alt:""}):e.jsx("div",{className:"border border-[#a5a4a4] w-[1rem] h-[1rem] rounded-[50%]"})}),e.jsx("img",{src:ye,alt:"",className:"mx-2 w-[3.625rem]"})]}),e.jsxs("div",{className:"basis-5/7  h-full flex flex-col gap-0.5",onClick:()=>b(a),children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsxs("div",{className:we(Te["machine-name"],"flex rounded-3xl pr-3 text-[.5rem] items-center"),children:[e.jsxs("div",{className:"font-bold",children:["#",ft(a.id)]}),e.jsx("div",{className:"text-white ml-3",children:"矿机"})]}),e.jsx("div",{className:"text-[#15b268] flex gap-1",children:e.jsx("img",{src:a.isProducing&&a.isActivatedStakedLP?at:st,alt:"",width:50})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"燃料费剩余："}),e.jsx(ze,{percent:ut(a.fuelRemainingMinutes),className:"flex-1",style:{"--fill-color":"#615371"}}),e.jsxs("div",{children:[ht(a.fuelRemainingMinutes),"天"]})]}),e.jsxs("div",{className:"flex gap-1",children:["累计产出积分：",e.jsx(_,{type:D.BALANCE,value:x(),decimalSubLen:2,className:"font-bold"}),"MIX"]}),e.jsxs("div",{className:"flex gap-1",children:["矿机生命剩余：",e.jsx(_,{type:D.BALANCE,value:xt(a.producedMix),decimalSubLen:2,className:"font-bold"}),"天"]})]})]},a.id)},gt=()=>{const[a,c]=s.useState([]),[b,x]=s.useState([]),[u,N]=s.useState([]),[w,U]=s.useState([]),[C,A]=s.useState(!1),[S,W]=s.useState(0),H=s.useRef(null),[h,d]=s.useState([]),o=Ce(),B=$e(),[ie,$]=s.useState(["全部(0)","已启动(0)","未开机(0)"]),[M,G]=s.useState("0"),{address:I}=fe(),[Q,V]=s.useState(""),[K,ce]=s.useState(""),[i,k]=s.useState(""),[J,p]=s.useState(0),[X,Y]=s.useState(!1),[R,ee]=s.useState(0),[te,se]=s.useState(0);s.useEffect(()=>{(async()=>{try{const f=await Ke(m,{address:I,chainId:Ge}),T=Je(f.value,f.decimals);V(T);const v=await y(m,{contracts:[{address:Be,abi:je,functionName:"balanceOf",args:[I]},{address:Ve,abi:je,functionName:"balanceOf",args:[I]},{address:me,abi:xe,functionName:"mixBalances",args:[I]}]});ce(F(v[0].result)),k(F(v[1].result)),p(Number(F(v[2].result)))}catch(f){console.error(f)}})()},[I]),s.useEffect(()=>{C&&d(a),a.length===h.length&&h.length>0&&A(!0)},[C,a,h]);const j=()=>{c(n=>{const f=n.map(T=>({...T,checked:!C}));return d(C?[]:f),f}),A(!C)},l=s.useCallback(n=>{c(f=>{const T=f.map(v=>v.id===n.id?{...v,checked:!v.checked}:v);if(!n.checked)d(C?a:[...h,n]);else{const v=h.filter(le=>le.id!==n.id);d(v),A(!1)}return T})},[C,a,h]),g=s.useCallback(async()=>{Y(!0);try{const f=(await z(m,{address:me,abi:xe,functionName:"getOwnerToMachineIds",args:[I]})).map(r=>Number(r)),T=f.map(r=>({address:me,abi:xe,functionName:"getMachineLifecycle",args:[r]})),v=(await y(m,{contracts:T})).map((r,E)=>({activatedAt:Number(r.result.activatedAt),createTime:Number(r.result.createTime),expiredAt:Number(r.result.expiredAt),destroyed:r.result.destroyed,isActivatedStakedLP:r.result.isActivatedStakedLP,isFuelPaid:r.result.isFuelPaid,isProducing:r.result.isProducing,mtype:r.result.mtype,checked:!1,status:r.status,id:f[E],lastProduceTime:Number(r.result.lastProduceTime),producedChildCount:Number(r.result.producedChildCount),producedHours:Number(r.result.producedHours),fuelRemainingMinutes:Number(r.result.fuelRemainingMinutes)})),le=v.filter(r=>r.mtype===2&&r.isActivatedStakedLP),Fe=le.map(r=>({address:Ze,abi:rt,functionName:"viewMachineProduction",args:[r.id]})),de=await y(m,{contracts:Fe}),Z=le.map((r,E)=>de[E].status==="success"?{...r,unclaimedChildCount:Number(de[E].result[2]),producedMix:Number(de[E].result[3]),unclaimedMix:Number(de[E].result[5])}:{...r,unclaimedChildCount:0,producedMix:0,unclaimedMix:0}),Re=v.map(r=>({address:me,abi:xe,functionName:"_isOnSale",args:[r.id]})),Ue=await y(m,{contracts:Re});let be=v.map((r,E)=>({...r,isOnSale:Ue[E].result})).filter(r=>{if(r.mtype===1)return!r.isOnSale;if(r.mtype===2)return!r.isActivatedStakedLP&&!r.isOnSale});be=be.filter(r=>!r.destroyed),se(be.length);const Xe=Z.reduce((r,E)=>r+E.unclaimedMix,0);ee(+F(BigInt(Xe)));const pe=Z.filter(r=>r.isProducing&&r.isActivatedStakedLP),ge=Z.filter(r=>!r.isProducing&&r.isActivatedStakedLP);N(pe),U(ge),x(Z),$([`全部(${Z.length})`,`已启动(${pe.length})`,`未开机(${ge.length})`]),M==="0"&&c(Z),M==="1"&&c(pe),M==="2"&&c(ge)}catch(n){console.log(n)}finally{Y(!1)}},[I,M]);s.useEffect(()=>{g()},[g]),s.useEffect(()=>{const{state:n}=B;n!=null&&n.needRefresh?g().then(()=>{o(B.pathname,{state:{...n,needRefresh:!1},replace:!0})}):n!=null&&n.fromMachineDetail&&g().then(()=>{o(B.pathname,{state:{...n,fromMachineDetail:!1},replace:!0})})},[B,g,o]),s.useEffect(()=>{h.length===a.length&&h.length>0?A(!0):A(!1)},[h.length,a.length]);const t=n=>{console.log("跳转的矿机ID:",n.id),o("/user/machineDetail",{state:{id:n.id,...n}})},L=s.memo(({index:n,style:f,data:T})=>{const q=T[n];return e.jsx("div",{style:{...f,height:"70px"},children:e.jsx(pt,{item:q,onLeftClick:l,onRightClick:t})})});s.useEffect(()=>{if(!H.current)return;const n=()=>{const q=window.innerHeight-100;W(q)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const ae=async()=>{if(h.length===0){Ae.show({content:"请选择要添加燃料的矿机",position:"center",duration:2e3});return}o("/user/addFuel",{state:h})},re=n=>n?e.jsx("img",{src:Me,alt:"",width:16,height:16}):e.jsx("div",{className:"border border-[#a5a4a4] w-[1rem] h-[1rem] rounded-[50%]"}),Ee=()=>{o("/user/toBeActivatedMachine")},Oe=s.useCallback(async()=>{o("/user/claimMix",{state:{machineList:a,mixPointsToBeClaimed:R}})},[a,R,o]),Pe=()=>{o("/user/mixBill")},_e=()=>{o("/user/exchangeIdx")},De=()=>{o("/user/syntheticMachine")},He=n=>{G(n),n==="0"&&c(b),n==="1"&&c(u),n==="2"&&c(w)};return e.jsxs("div",{className:" flex flex-col justify-between",children:[e.jsxs("div",{className:"px-[21px] ",children:[e.jsxs("div",{className:"bg-[#09090a] rounded-2xl text-white px-4 py-2 text-[1rem] relative",children:[e.jsx("div",{className:"text-[#c6c6c6] text-[12px] font-[400] flex",children:"钱包余额"}),e.jsxs("div",{className:"flex mt-1 mb-1 items-center gap-1",children:[e.jsx("img",{src:Ye,alt:"",width:16,height:16}),e.jsx("div",{className:"text-[#c6c6c6] text-[10px] font-[400] w-[27px]",children:"USDT"}),e.jsx("div",{children:e.jsx(_,{type:D.BALANCE,value:i,decimalSubLen:2,className:"ml-2 mr-1.5"})})]}),e.jsxs("div",{className:"flex my-1 items-center  gap-1",children:[e.jsx("img",{src:et.bscSvg,alt:"",width:16,height:16}),e.jsx("span",{className:"text-[#c6c6c6] text-[10px] font-[400] w-[27px]",children:"BNB"}),e.jsx("div",{children:e.jsx(_,{type:D.BALANCE,value:Q,decimalSubLen:2,className:"ml-2 mr-1.5"})})]}),e.jsxs("div",{className:"flex  gap-1  mb-2 items-center",children:[e.jsx("div",{className:"bg-[#895eff] rounded-[50%] text-[7px] flex items-center justify-center w-[16px] h-[16px]",children:"IDX"}),e.jsx("span",{className:"text-[#c6c6c6] text-[10px] font-[400] w-[27px]",children:"IDX"}),e.jsx("div",{children:e.jsx(_,{type:D.BALANCE,value:K,decimalSubLen:2,className:"ml-2 mr-1.5  font-bold"})})]}),e.jsx("img",{src:tt,alt:"",width:71,height:87,className:"absolute top-[2.5rem] right-[2.5rem]"})]}),e.jsxs("div",{className:"bg-black rounded-2xl text-white p-4 text-[1rem] mt-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"bg-[#0B8659] rounded-[50%] text-[7px] flex items-center justify-center  w-[16px] h-[16px]",children:"MIX"}),e.jsxs("div",{children:[e.jsx(_,{type:D.BALANCE,value:J,decimalSubLen:2,className:"ml-2 mr-1.5"}),e.jsx("span",{className:"text-[#c6c6c6] text-[10px] font-[400]",children:"MIX"})]})]}),e.jsxs("div",{className:"flex gap-2 text-[10px] items-center",onClick:Pe,children:["账单",e.jsx("div",{className:"w-[16px] h-[18px] bg-[#333] rounded-[50%] text-[.6875rem] flex items-center justify-center ",children:"i"})]})]}),e.jsxs("div",{className:"flex gap-2 text-[#c6c6c6] mt-4",children:[e.jsx("div",{onClick:De,className:"flex-[1] text-center bg-[#09090a] border border-[#212122] rounded-3xl py-1 text-[.7rem]",children:"合成矿机"}),e.jsx("div",{onClick:_e,className:"flex-[1] text-center bg-[#09090a] border border-[#212122] rounded-3xl py-1 text-[.7rem]",children:"兑换IDX"})]})]}),e.jsxs("div",{className:"flex mt-2 items-center   text-[#C7BEDF] gap-2",children:[e.jsx(Ne,{onClick:Oe,className:"flex-1/2 !bg-[#09090a] !rounded-2xl  !mb-2  !items-center  !py-1 ",children:e.jsxs("div",{className:"flex flex-col !text-[#C7BEDF] ",children:[e.jsx(_,{type:D.BALANCE,value:R,decimalSubLen:2,className:"ml-2 mr-1.5 text-[#895EFE] font-bold text-[1rem]"}),e.jsx("div",{className:"text-[.75rem]",children:"挖矿产出（MIX）"})]})}),e.jsx(Ne,{onClick:Ee,className:"flex-1/2 !bg-[#09090a] !rounded-2xl  !mb-2  !items-center  !py-1 ",children:e.jsxs("div",{className:"flex flex-col !text-[#C7BEDF] text-[.75rem]",children:[e.jsx("div",{className:"ml-2 mr-1.5 text-[#895EFE] font-bold text-[1rem]",children:te}),e.jsx("div",{className:"text-[.75rem]",children:"矿机管理（个）"})]})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ie,{className:"mr-6 h-[36px] ",checked:C,icon:n=>re(n),onClick:j,style:{"--font-size":"12px","--gap":"6px",padding:"8px 0 10px"},children:"全选"}),e.jsx(ve,{direction:"vertical",style:{borderColor:"#666",height:"15px"}})]}),e.jsx(he,{activeKey:M,onChange:He,style:{"--active-line-height":"0"},className:`
                  ${Te["adm-tabs"]}
                  !h-[40px] !shrink-0  
                  [&_.adm-tabs-tab-wrapper]:flex-none [&_.adm-tabs-tab-wrapper]:px-0  
                  [&_.adm-tabs-tab.adm-tabs-tab-active]:font-bold [&_.adm-tabs-tab.adm-tabs-tab-active]:opacity-100 
                  [&_.adm-tabs-tab]:text-[12px]
                  [&_.adm-tabs-tab]:pb-[11px] 
                  [&_.adm-tabs-tab]:pt-[14px] 
                  [&_.adm-tabs-tab]:opacity-40 [&_.adm-tabs-tab]:transition-transform
                `,children:ie.map((n,f)=>e.jsx(he.Tab,{title:n,className:"flex flex-col"},f))})]}),e.jsx("div",{ref:H,style:{height:`${S}px`},className:"no-scrollbar mb-[4rem]",children:X?e.jsx(Qe.Paragraph,{lineCount:6,animated:!0,className:"customSkeleton"}):a.length>0?e.jsx(Le,{height:S,width:"100%",itemCount:a.length,itemSize:100,itemData:a,children:L}):e.jsx(ke,{})})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 w-full bg-white  py-[.75rem] flex items-center mt-auto px-[21px]",onClick:ae,children:[h.length>0&&e.jsx("div",{className:"bg-[#F1F1F3] rounded-[50%] w-[32px] h-[32px] flex justify-center items-center text-[#895FFE] font-bold",children:h.length}),e.jsxs("div",{className:"flex flex-col items-center justify-center  mx-auto",children:[e.jsx("img",{src:dt,alt:"",width:18}),e.jsx("span",{className:"text-[.8125rem] mt-1",children:"添加燃料"})]})]})]})},Nt=({isShow:a})=>{const[c,b]=s.useState(""),{address:x}=fe(),[u,N]=s.useState([]),w=Ce(),U=ne.getUnPaidLength(),C=i=>{b(i)},[A,S]=s.useState(0),W=s.useRef(null),[H,h]=s.useState(0),[d,o]=s.useState(0),[B,ie]=s.useState(0),$=s.useCallback(async()=>{try{const i=await z(m,{address:Be,abi:je,functionName:"balanceOf",args:[x]});h(+F(i))}catch(i){console.error(i)}},[x]),M=s.useCallback(async()=>{try{const i=await z(m,{address:O,abi:P,functionName:"CHILD_MACHINE_PRICE",args:[]});o(Number(i))}catch(i){console.error(i)}},[]);s.useEffect(()=>{a&&M()},[M,a]),s.useEffect(()=>{a&&$()},[$,a]),s.useEffect(()=>{if(!W.current)return;const i=()=>{const p=window.innerHeight-100;S(p)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const G=()=>{if(+c==0){Ae.show({content:"请输入购买数量",position:"center"});return}w("/user/myOrders",{state:u.filter((i,k)=>k<+c)})},I=({index:i,style:k,data:J})=>{const p=J[i],X=()=>{if(p.seller===x)w("/user/myPublishMachineTx",{state:p});else return};return e.jsx("div",{style:{...k,height:"70px"},children:e.jsxs("div",{className:we([p.seller!==x?"px-[.9375rem]":"pl-[.9375rem]"]," py-[.9375rem] bg-white rounded-3xl flex mt-2 gap-2"),onClick:X,children:[e.jsx("img",{src:ye,alt:"",className:"w-[3.625rem]"}),e.jsxs("div",{className:"flex text-[.625rem]",children:[e.jsxs("div",{className:"w-[70px] flex flex-col gap-1 text-[#5B5B5B]",children:[e.jsx("div",{children:"出售中"}),e.jsx("div",{children:"矿机卖家:"}),e.jsx("div",{children:"上架时间:"})]}),e.jsxs("div",{className:"ml-auto w-[73%] font-bold flex flex-col gap-1",children:[e.jsx("div",{children:"..."}),e.jsx("div",{children:it(p.seller,4)}),e.jsx("div",{children:ct(p.listedAt)})]})]}),p.seller!==x?e.jsxs("div",{className:"ml-auto mt-auto font-bold text-[.75rem]",children:["NO.",p.NO]}):e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex flex-col justify-between items-center",children:[e.jsx("div",{className:"bg-[#895EFF] rounded-2xl px-2 text-white text-[.625rem]",children:"我发布的"}),e.jsxs("div",{className:"text-[#895EFF] text-[.75rem]",children:["NO.",p.NO]})]}),e.jsx("img",{src:nt,alt:"",width:20})]})]})})},Q=s.useCallback(async()=>{try{const i=await z(m,{address:O,abi:P,functionName:"activeListedOrderCount",args:[]}),k=new Array(Number(i)).fill(1).map((l,g)=>({address:O,abi:P,functionName:"allListedOrderIds",args:[g]})),X=(await y(m,{contracts:k})).map(l=>Number(l.result)).map(l=>({address:O,abi:P,functionName:"listedOrders",args:[l]})),R=(await y(m,{contracts:X})).map(l=>({orderId:Number(l.result[0]),machineId:Number(l.result[1]),seller:l.result[2],priceInIdx:+F(l.result[3]),listedAt:Number(l.result[4]),status:Number(l.result[5])})),ee=R.map(l=>({address:O,abi:P,functionName:"internalOrders",args:[l.orderId]})),te=await y(m,{contracts:ee});let j=R.map((l,g)=>({...l,buyer:te[g].result[1]})).filter(l=>l.status===0&&l.seller!=="0x0000000000000000000000000000000000000000");console.log("itemListWithBuyer",j),ne.updateAllListedOrders(j),j=j.sort((l,g)=>l.listedAt-g.listedAt).map((l,g)=>({...l,NO:g+1})),N(j),console.log("user machine tx list",j)}catch(i){console.error(i)}},[]);s.useEffect(()=>{Q()},[Q]);const V=async()=>{try{const i=await z(m,{address:O,abi:P,functionName:"getIDXAmount",args:[1]});ie(Number(F(i)))}catch(i){console.error(i)}};s.useEffect(()=>{V()},[]);const K=()=>+c>u.length?"库存不足":H<+c*d?"余额不足":"去支付",ce=()=>{w("/user/history")};return e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"px-[21px]",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-[15px]",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("img",{src:ye,alt:"",className:"w-[2.5625rem]"}),e.jsxs("div",{className:"text-[.6875rem]",children:[e.jsx("div",{children:"类型： 矿机"}),e.jsxs("div",{children:[e.jsx(_,{type:D.BALANCE,value:d*B,decimalSubLen:2,className:"font-bold text-[1.25rem] mr-2"}),"IDX/台 ≈ ",d,"USDT/台"]})]})]}),e.jsxs("div",{className:"flex h-[40px]",onClick:ce,children:[e.jsx("div",{className:"pt-[.3125rem] text-[14px] font-bold",children:"交易记录"}),U>0&&e.jsx("div",{className:"bg-[red]  p-1 rounded-3xl h-[15px] flex items-center justify-center text-white text-[.6rem] leading-[.6rem]",children:U})]})]}),e.jsx(ve,{className:"!my-3"}),e.jsx("h1",{className:"font-bold text-[.875rem] mb-2",children:"矿机权益"}),e.jsxs("div",{className:"text-[.75rem] ",children:[e.jsxs("div",{className:"pl-[2.5rem] relative",children:[e.jsx("div",{children:"每台矿机每日产出4个MIX积分，每日00:00:00-01:00:00到账;"}),e.jsx("div",{className:"absolute left-[25px] top-[5px] bg-black w-[7px] h-[7px] rounded-[50%]"})]}),e.jsxs("div",{className:"pl-[2.5rem] flex gap-2 text-[.75rem] relative",children:[e.jsx("div",{children:"每80个MIX积分合成1台矿机，合成出来的矿机，可转让或保留用于挖取积分；"}),e.jsx("div",{className:"absolute left-[25px] top-[5px] bg-black w-[7px] h-[7px] rounded-[50%]"})]})]}),e.jsx(ve,{}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-[100px] text-[.875rem]  font-bold",children:"购买数量"}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(qe,{placeholder:"输入整数",style:{"--font-size":".875rem"},className:"!bg-[#f3f3f3] rounded-3xl px-4 py-1 ",value:c,type:"number",onChange:C}),e.jsx("span",{className:"absolute right-[20px] top-[.3125rem] text-[.875rem]",children:"台"})]})]}),e.jsxs("div",{className:"flex justify-end mt-1 gap-1 text-[.625rem] items-end",children:["钱包余额：",e.jsx(_,{type:D.BALANCE,value:H,decimalSubLen:2,className:"font-bold text-[.6875rem]"}),"IDX"]})]}),e.jsx("div",{ref:W,style:{height:`${A}px`},className:"no-scrollbar mb-[4rem]",children:u.length>0?e.jsx(Le,{height:A,width:"100%",itemCount:u.length,itemSize:95,itemData:u,children:I}):e.jsx(ke,{})})]}),e.jsxs("div",{className:"w-full bg-white h-[4rem] flex items-center absolute bottom-0 px-[1.875rem]",children:[e.jsxs("div",{children:[e.jsx("div",{children:"待支付 IDX"}),e.jsx("div",{className:"text-[#FF6D6D] text-[20px] font-bold",children:e.jsx(_,{type:D.BALANCE,value:+c*d*B,decimalSubLen:2,className:"mr-1.5  font-bold"})})]}),e.jsx(Ne,{className:"!bg-black !text-white !rounded-3xl !ml-auto   !h-[40px] !w-[100px]",style:{fontSize:"15px"},onClick:G,disabled:H<+c*d*B||+c>u.length,children:K()})]})]})},Ft=()=>{const[a,c]=s.useState(0),b=[{title:"首页",children:e.jsx(gt,{})},{title:"矿机交易",children:e.jsx(Nt,{isShow:a===1})}],x=w=>{c(w)},{isConnected:u}=fe(),N=Ce();return s.useEffect(()=>{u||N("/")},[u,N]),e.jsxs("div",{className:"pt-2 h-full overflow-hidden relative",children:[e.jsx(mt,{tabs:b,customClassName:"w-[50%]",getTabKey:x,defaultKey:0,titleFontSize:"1rem"}),e.jsx("div",{className:"absolute top-[1.25rem] right-[1.25rem]",children:e.jsx(lt,{})})]})};export{Ft as default};
